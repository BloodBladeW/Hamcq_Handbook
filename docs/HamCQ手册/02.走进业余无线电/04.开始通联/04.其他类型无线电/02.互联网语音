---
title: 数字语音
date: 2024-07-20 18:50:00
permalink: /pages/7782707/
categories:
  - HamCQ手册
  - 走进业余无线电
  - 开始通联
  - 其他类型无线电
tags:
  - 
---
> 本文编辑：@BloodBlade

# 网络系统和相关设备

数字语音可以像模拟FM设备那样脱离互联网来使用，但大部分HAM购入这类设备都仅仅只是看中了它们能够将信号通过互联网传输的能力。

## 网络结构

在将数字语音信号输入互联网之前，需要对相关系统的结构有些了解。

对于D-Star和系统融合这两种业余专用的数字语音模式来说，它们的网络结构也大致相同。
在网络中，最主要的部分有两个，分别是收发射频信号，将其接入网络的部分，通常称为网关或节点；
以及接收网关或节点传输来的数据，将其分发给其他连接的网关或节点的部分，通常称为反射器或房间。

一般来说，网关需要接收射频信号，所以都会和电台相连或内置射频收发能力。而反射器则通常是纯软件程序。

### D-Star

D-Star网关一般会与中继相连接。除了中继之外，一些较新的D-Star设备可以自身作为网关（内部网关模式）或连接其他设备上的网关软件（外部网关模式）。

D-Star在开发时只考虑过将中继互相连接，并没有考虑到反射器的存在。
后来则一些人开发了被称作反射器的软件，它通过将自身伪装为中继来接入D-Star网络，因此连接中继和连接反射器实际上是同样的操作。
在D-Star反射器中，通常可以提供多个模块。
由于D-Star中继系统也有模块的概念，因此不要混淆中继模块和反射器模块。
反射器模块的作用是将一个反射器分为多个聊天室，这些模块通常具有不同的用途。

目前最常用的反射器软件是[XLX反射器](https://github.com/LX3JL/xlxd)。
XLX反射器除了D-Star的相关协议之外，还支持连接AMBE芯片来与系统融合以及DMR模式进行转换。
因此除了D-Star外，他还支持系统融合模式的YSF协议和IMRS协议以及DMR模式的DMR Plus协议和DMR MMDVM协议。

国内最常用的XLX反射器分别是[XLX055](http://52.80.4.154/dstar/)和[XLXCHN](http://xlx.asia)。

在加入D-STAR网络之前，需要先进行注册，原则上应联系最近的中继网关运营者进行注册，比如国内最大的D-STAR中继系统的运营者[辽宁业余无线电俱乐部](https://www.lnham.club)，而本地没有D-STAR网关的用户则可以在[D-STAR Gateway System](https://regist.dstargateway.org/Dstar.do)注册。
其注册流程十分简单，点击`Register`后，同意协议，输入呼号、姓名、电子邮件地址和密码后，点击`OK`。之后只要等待几天接收到审核通过的邮件就成功了。

### 系统融合

系统融合的结构和D-Star大同小异。不同的是，仅仅使用的话不需要任何注册操作。

实际上，系统融合有两个独立的网络，分别是[Wires-X](https://www.yaesu.com/jp/en/wires-x/index.php)和YSF。

Wires-X是由八重洲官方设置的网络，在连接网络时不需要注册，只有需要在八重洲官方运营的中开设节点或房间时才需要注册。
此外，在Wires-X中设置开设房间时则必须要购买HRI-200的配件。
不过该网络国内几乎没有人使用。

在国内，大部分用户都使用YSF网络，这是由HAM们开发的开源反射器YSF所组成的网络。
有两个反射器软件都可以接入YSF网络，分别是[YSFReflector](https://github.com/nostar/DVReflectors/tree/main/YSFReflector)和[pYSFReflector3](https://github.com/iu5jae/pYSFReflector3)。
前者由MMDVM的作者G4KLX开发，但目前已经移交给DroidStar的作者进行维护。后者则是使用Python开发的替代品。

为了与Wires-X兼容，大部分YSF反射器都会在[YSFReflector-Registry](https://register.ysfreflector.de)中注册并获得一个唯一的代码。
这个代码大都是5-6位数字，因此容易与DMR的谈话组ID混淆。

通常长按Wirex-X按键即可连接到中继或热点的软件中来进行切换反射器或房间和节点，或使用其他Wires-X功能。

### DMR

DMR模式并未考虑过业余使用，因此它只支持中心化服务器，而不是像D-Star等业余模式那样的对等联邦式网络。
DMR模式有三个比较活跃的服务器集群，分别是由于摩托罗拉业余俱乐部组建的DMR-MARC、欧洲摩托罗拉经销商赞助并使用摩托罗拉内部代码组成的BrandMeister和完全开源软件组成的FreeDMR。
由于这些网络并不互通，因此你无法在一个网络中呼叫另一个网络的用户。如果你想使用多个网络，也需要分别在这些网络的服务器当中中注册。

由于DMR等专业数字语音模式不支持呼号，为了建立呼号与ID一一对应的关系，摩托罗拉业余俱乐部（MARC）牵头开启了审核并分配ID的的工作，后来则独立出来成立了Radio ID组织，也新增了分配P25 ID（与DMR ID相同，无需重复分配）和NXDN ID（大陆注册的账号需要发起工单而不能自助申请）的业务。

让DMR设备连接互联网必须要在Radio ID组织进行注册，需要注意的是，该网站国内难以访问且注册流程较为复杂，因此请准备好特定的上网方式，或请他人代为注册（不推荐，因为需要提交个人信息进行验证）。
* 首先访问[Radio ID注册页面](https://radioid.net/account/register)，阅读并勾选同意上述内容之后，点击`Register Account`进入注册页面。
* 在注册页面中填写填写呼号、电子邮件、密码。国家或地区不需要填写，当填入呼号后这一栏会自动填写。填写后不要点别的东西，直接进行下一步。
* 保持注册页面不要关闭，需要进入电子邮箱，找到验证邮件并点击验证连接。
* 邮箱验证通过后，回到之前填写信息的页面，会发现邮件一栏的边框变成绿色，此时点击人机验证，通过后点击`Create Account`。
* 在账号注册后需要进行身份验证，登陆Radio ID网站，点击右上角写着自己呼号的按钮，选择`Profile`。
* 进入个人页面后先填写个人信息，需要填写的内容有名字、姓氏、城市、地区、和执照有效期，填写完成后保存。
* 保存后需要对操作证和执照进行拍照，将两者摆放在一起，露出上面的信息不要遮挡（根据个人经验，身份证号可以打马赛克，不过可能要看审核员的心情）。
* 拍照完成后在个人信息页面选择刚才的照片并进行提交。
* 提交后等待几天，会在邮箱中收到审核通过的电子邮件，这时候再登陆Radio ID，点击右上角自己呼号，选择`Dashboard`即可看到自己的DMR ID。

DMR ID除了用于电台中，还会被用于热点等网关设备中，为了区分这些设备，可以在DMR ID后面附加2位数字作为ESSID。

在获得DMR ID后，还有另一件事要做，就是在DMR服务器中注册。
由于BrandMeister网络是国内用户最多的网络，因此以BrandMeister为例进行注册。
* 访问[BrandMeister注册页面](https://brandmeister.network/?page=register)，填写呼号、电子邮件地址、DMR ID、密码并回答最后的问题：UHF波段的波长是多少厘米？
* 注册后进入邮箱找到验证邮件进行验证。
* 继续等待BrandMeister的志愿者审核信息。
* 当审核通过后，需要设置热点密码。**中国区的BrandMeister4601服务器强制要求热点密码不能使用默认密码，因此不可跳过此环节。**
* 登陆BrandMeister网站，点击左侧的`SelfCare`。
* 在`Hotspot Security`下面的输入框中输入热点密码，然后点击`Save Password`

至此，所有的必须环节都已经完成，不过仍然推荐进行下面的可选操作：

默认情况下，虽然设置热点需要密码，但是通过他人设置好的热点或中继台访问BM网络是不需要密码的。
而BM网络和其他网络相比，用户基数很大，人多嘴杂，DMR ID又是公开信息，很可能会有盗用ID的情况出现，如果平时都使用热点来连接BM网络，那么设置TOTP验证码会很有帮助。
* 安装一个可以生成TOTP验证码的程序。
* 访问设置热点密码的页面，即`SelfCare`。
* 打开AirSecurity/TOTP后面的开关，将其设置为On。
* 选择授权范围，用默认的`Repeater`即可。他的意思是每次授权一个中继。另外两个选项分别为授权一组中继和授权一个服务器，用处不是很大。
* 用TOTP验证码程序扫描出现的二维码并保存验证码项目。
* 点击右下角的`Save`按钮即可。

现在，当你使用自己的热点时，无需输入验证码。而当你需要用中继或其他人的热点时，需要打开TOTP程序，然后对特定DMR ID进行单呼操作。
其DMR ID为9+TOTP验证码，例如验证码为123456，则对`9123456`进行单呼。
只有在进行该单呼操作后，这个中继或热带才会被授予临时使用权。而盗用者由于不知道验证码，因此无法对中继或热点进行授权。如果不授权直接呼叫的话，就只会听到BM服务器返回的访问被拒绝的提示。

如果你经常使用某一个谈话组的话，可以在BrandMaster的设置中将其添加到静态组。

出于集群需要使用过多频率等种种原因，业余使用的DMR通常工作在中继模式，即Tier2模式而不是具有集群功能的Tier3模式。
这也导致所有的通话都会被发射出来，而不是像集群模式那样，只有当该基站下有人加该入谈话组后才会被发射出来。

由于DMR和所有通话均发生在同一个服务器中，如果像正常的DMR服务器一样每一个通话都进行传输，那么频率将会被一直占满，无法说话。
因此，BrandMaster提供了动态组和静态组功能。

动态组的作用是当参与某谈话组通话时，之后一段时间内该谈话组的通话将会被发送到参与者所使用的中继或热点等设备中；
静态组则是预先为特定中继或热点设置一些固定加入的谈话组，无论之前是否发生过通话，该谈话组的通话都会被发送至该设备。

如果需要设置静态组，首先登陆BrandMeister网站，在左侧选择My Devices，然后选择要设置静态组的设备，如果有多个设备，可以通过修改设备设置中的ESSID来区分。

进入设备页面后，在下方的Static TalkGroups中设置静态组。左侧为输入框，右侧为静态组列表。

在左侧输入谈话组ID，点击指向列表的箭头即可将谈话组加入静态组列表；选择列表中的谈话组，并点击反向的箭头则可以将谈话组从静态组列表中移除。

一般来说，不建议设置过多的静态组，因为多个静态组更容易一起发生通话，使该设备占满无法使用。

## 硬件选择

如果使用的是较新的D-Star设备，那通常无需而外选择热点或类似设备，不过实际上为了方便起见，许多人也会购买热点。
而如果使用系统融合或DMR设备的话，热点则通常是必须的选项。

热点分为SharkRF OpenSpot热点和多模式数字语音调制解调器（Multi-Mode Digital Voice Modem, MMDVM）。
前者是闭源设备，其内部只使用ESP32微控制器，因此耗电量更低，启动速度更快，是更好的选择。但是价格十分昂贵，因此MMDVM是更流行的选择。

MMDVM有两个部分，分别是运行于电脑上的MMDVM Host及各模式的网关等程序和运行于微控制器的中的MMDVM固件。
根据固件的不同，MMDVM又可以分成热点固件和中继固件。

热点固件需要使用亚诺德的集成收发器ADF7021，这款收发芯片内置了FSK编解码器，大大降低了微控制器的负担。因此热点通常使用更为性能较低的STM32F103微控制器。
而中继固件直接由微控制器中的DAC和ADC来产生和接收信号，这些信号会连接到外部电台的9600接口或数传接口并直接由电台进行发射。因此中继固件需要使用性能更为强大的微控制器，如STM32F4系列。
从外形来看，热点设备通常具有2-3枚芯片，并有天线或射频接口；而中继设备通常只有一块芯片，其他的外围电路都是较为简单的元器件，接口通常也是9600接口常用的DIN接口。

市面上销售的MMDVM设备通常会选择遵守树莓派Hat规范，这样可以直接插入树莓派等单板计算机中。由于MMDVM固件使用串口与MMDVMHost通信，因此使用USB转串口设备即可将其简单的接入其他设备中。
当然，也可以选择购买ADF7021模块和STM32开发板进行连接来作为热点，或自行设计适配与开发板的外围电路来组建中继板。

当然，市售的热点设备也会有“单工板“和”双工板“的区别，单工板实际上以半双工模式工作，双工板实际上以全双工模式工作。
对于非DMR设备，选择单工板完全足够，而DMR设备想要使用时隙功能，则必须使用双工板。至于具体原因，可以重新复习上一节DMR部分的第二段。

## 软件部分

### 系统安装

大部分MMDVM设备都会选择树莓派等单板计算机来运行Linux和MMDVM Host等程序。如果对Linux不够了解的话，[Pi-Star](https://www.pistar.uk/)项目已经打包好了所有的程序并提供了图形化配置界面，只要下载并安装在单板机中即可使用。
另外还有将原本Pi-Star的界面替换为更花俏版本的项目[WPSD](https://w0chp.radio/wpsd/)。
它们内部的MMDVM Host等软件没有区别，唯一的区别就是界面。Pi-Star的界面更为朴素，消耗资源很少。而WPSD的界面更为花俏，消耗资源很大。
例如Pi-Star可以在树莓派Zero W上良好运行，而WPSD就会卡顿。如果选择WPSD系统的话，建议硬件选择配置更高的树莓派Zero 2W或同配置的树莓派3B+。
不过实际上两者的操作方式大同小异，会用其中一个，自然也就会用另一个。

如果你购买的是内部包含单板机和MMDVM设备的套件，那通常安装系统的环节已经由商家完成了，你可以跳过本章节，直接查看如何配置。

首先访问[Pi-Star下载页面](https://www.pistar.uk/downloads/)或[WPSD下载页面](https://w0chp.radio/wpsd/#download-wpsd)，选择适合自己设备的镜像下载。
Pi-Star支持的设备有树莓派系列、香橙派Zero、Nano派和Odroid-XU4；WPSD支持的设备有树莓派系列、香橙派Zero和Nano派Neo。

下载完成后，需要准备系统烧录工具，比如[树莓派镜像烧录器](https://www.raspberrypi.com/software/)，下载安装后，将准备用来安装系统的储存卡插入电脑。
连接储存卡后，打开刚才安装的烧录器，点击选择操作系统，选择最下面的`Use custom`，找到上一步下载的镜像并确认。然后点击`选择SD卡`并选择之前插入的储存卡。
完成后点击NEXT，会弹出设置窗口，**这里不需要修改任何设置，直接点击`不`**，然后会弹出警告提示，在确认储存卡中没有需要保留的文件后，点击`是`开始烧录并等待烧录完成。

### 基本配置

烧录完成后，组装MMDVM、单板机和储存卡，连接电源并等待几分钟开机。

如果你的单板机是只有Wi-Fi的设备，由于初次开机后没有系统内任何保存的Wi-Fi信息，因此会进入AP模式。
这时候需要在电脑的Wi-Fi列表中寻找名为`Pi-Star-Setup`的无密码Wi-Fi并连接（WPSD从Pi-Star的基础上改造而来，也使用这个名字）。
如果是通过有线网络连接的设备，则可以跳过本段直接进入下一段。

打开网页浏览器并访问Pi-Star页面<http://pi-star.local>。如果该设置地址无法访问，可以查找单板机的IP地址并访问（通过单板机的Wi-Fi连接的情况下，很可能是<http://192.168.50.1>）。
当初次访问该页面时，会看到页面显示为`No Mode Define`，这时候点击`Configuartion`来进入配置界面。
这时候通常会询问用户名和密码，默认的用户名是`pi-star`，默认的密码是`raspberry`。

进入配置页面后，这里为了方便使用，首先将其修改为中文。找到`Dashboard Language`一项，将其设置为`chinese_cn`，然后点击`Apply Changes`，等待配置应用并重启，即可看到界面变为中文。

如果使用Wi-Fi的话，需要现在进行配置。对于仅有Wi-Fi的设备来说，这是必须的配置项；对于使用有线网络的设备则并不必要。
将配置页面翻到下面，找到Wi-Fi配置一栏，并点击`Configure WiFi`按钮进入配置界面。
在进入配置界面后，首先选择Wi-Fi区域，选择CN即可。然后点击`Scan for Networks (10 secs)`按钮来搜索Wi-Fi。
在扫描完成后，找到想要加入的Wi-Fi，点击前面的`Select`按钮，然后在`PSK`输入框中输入密码，最后点击`Save (and connect)`。
需要注意的是，如果是使用AP模式连接并访问到配置页面，则不会自动连接。需要在保存完成之后，翻到页面最上方，点击`电源`，然后点击绿色的重启按钮。
在重启完成之后，会自动连接到保存的Wi-Fi而不会进入AP模式。不过，如果启动后所有保存的Wi-Fi都无法连接，那么系统会重新进入AP模式。

最后进行时区配置，在配置页面的常规配置中，找到时区一项，将其改为`Asia/Shanghai`，然后点击应用设置。

### MMDVM设置

在系统的基本配置完成后，就该进行MMDVM配置了。
首先进入配置界面，在最上方的控制软件配置中，将控制器软件设置为`MMDVMHost`，然后根据设备类型决定控制器模式，只有一个收发单元的设备设备选择`Simplex Node`，有两个收发单元的设备选择`Duplex Repeater (or Half-Duplex on Hotspots)`。
最后点击应用设置等待系统保存配置并启动MMDVMHost。

在常规配置中找到电台/调制解调器类型，这一项的配置取决于你购买的MMDVM设备是什么，询问购买的商家即可。
通常单工热点版选择`MMDVM_HS_Hat (DB9MAT & DF2FET) for Pi (GPIO)`、双工热点板选择`MMDVM_HS_Dual_Hat (DB9MAT & DF2ET & DO7EN) for Pi (GPIO)`。
选择完成后点击应用设置并等待重启。

接下来在常规配置中设置呼号，通常填写自己的呼号。如果需要使用DMR等专业数字语音模式的话，还需要在CCS7/DMR ID中填写该呼号对应的DMR ID。
然后设置热点频率，单工热点板只需要设置一个频率，而双工热点版需要像中继一样设置上行和下行频率。
最后设置节点类型，`Private`类型意味着只有和节点呼号相同的设备才能使用该热点，而`Public`的意思则是允许任何呼号的设备使用该热点。
设置完成后，点击应用设置并等待重启。

### D-Star配置

相较于D-Star电台段的复杂性，热点一端的设置较为简单，首先设置RPT1呼号，通常建议根据频率来选择，即144MHz范围选择C、430MHz范围选择B。
当然，也可以不按照建议，任意选择。

ircDDDBGateway密码和是用于ircDDDBGateway Remote软件的，这里不需要修改。ircDDDBGateway语言中没有中文，因此也不需要修改。

默认反射器可以设置一个自己喜欢的，后面的`Startup`(启动时自动连接）和`Manual`（手动连接）可以按需要选择。

时间通告的作用就是每隔一段时间会进行报时，可按需要开关。

Callsign Routing就是上文提到的呼号路由功能支持，它是通过ircDDDB网关实现的该功能。如果想用的话，可以打开。

最后是Use DPlus For XRF，DPlus是较老的反射器软件，而XRF则是现在流行的XLX反射器软件的原型。区别是是否需要路由器支持UPnP或手动设置端口转发。
不过现在新型的反射器协议不需要该功能，而且国内网络大多不给公网IP，这个选项没什么意义，保持默认的关闭即可。

设置完成后，点击应用设置并等待重启。

### 系统融合配置

系统融合的配置更为简单，选择默认服务器即可。UPPERCASE Hostfiles的作用只使用大写字母保存服务器列表，目的是增加FT-70D兼容性，使用该设备可以开启该选项。
完成后点击应用设置并等待即可。

#### YSF2DMR交叉模式

由于YSF的DN模式、DMR模式和NXDN模式使用相同的声音编码，因此这三个模式可以在保持声音编码不变的前提下互相转换。
这种交叉模式，也能用来连接不同模式的网络，比如使用打开YSF2DMR模式后，将频率调整为另一个DMR模式的热点（或反其道而行之），即可连接相应的YSF反射器和DMR谈话组。

开启该模式后，MMDVM内部会启动一个特殊的YSF服务器，该服务器会将收到的YSF数据转换为DMR数据。
同时也会将收到的Wires-X信令转换的DMR信令，使得可以通过Wires-X来切换DMR谈话组。

由于DMR模式必须要求DMR ID，因此如果之前没有在常规配置中填写CCS7/DMR ID的话，现在必须填写。

保存好DMR ID后，将YSF默认服务器选择为`YSF00002 - Link YSF2DMR`，之后选择DMR ID的后缀，选择与其他热点不同的即可。

接下来选择是否打开WIresX Passthrough功能，当该功能关闭时，通过电台的Wires-X功能获得的服务器列表和切换服务器功能将是YSF网络的。
而该功能打开，且YSF服务器被设置为`YSF00002 - Link YSF2DMR`时，MMDVM的YSF网关将不会响应Wires-X信令，而是将其交由YSF2DMR来处理。
这时候通过电台的Wires-X功能切换的就会是DMR谈话组而不是YSF反射器。

然后选择DMR主机，国内通常使用`BM_4601_China`。选择好后输入之前步骤中设置的BrandMeister的热点密码。

最后输入DMR TG，输入自己常用的就行，如果没有的话，46001是国内人数较多的DMR谈话组。

### DMR配置

上文的YSF2DMR配置实际上就是DMR配置的子集，国内通常选择`BM_4601_China`作为DMR主机，应用设置后会出现Hotspot Security的输入框，在其中输入BrandMeister的热点密码。

之后选择DMR ESSID，选择与其他DMR设备不同的即可。

DMR彩色码有些类似模拟FM的CTCSS或DCS静噪代码，和电台设备上保持一致即可。

DMR EmbeddedLCOnly这一选项的用途是清除DMR的带内信息，其内容通常是GPS和别名信息。一般不需开启，但如果DMR电台的对带内信息支持有问题，则可以打开它。

最后一项DMR DumpTAData的作用是在MMDVM的日志中记录GPS和别名信息，保持默认不变即可。

完成后点击应用设置并等待重启。

#### DMR2YSF

和YSF2DMR相反，这个功能是将DMR数据传输到YSF网络中。

打开该功能后，需要将DMR主机设置为`DMR2YSF`并应用设置。

应用后会发现YSF设置也会被打开，选择一个默认的YSF服务器即可。
